function check_bg_height(){$(".test__bg").outerHeight()!=$(".test")[0].scrollHeight&&$(".test__bg").css("height",$(".test")[0].scrollHeight+"px")}function drag_reset(){counter=0,$(".drop--accept").removeClass("drop--accept"),$(".moved").removeClass("moved"),indicator.hide(),ripple.dissolve(),original_el=void 0,$(".test>svg").css({transform:"",opacity:0})}function drag_over(t){return t.preventDefault&&(t.preventDefault(),t.stopPropagation()),!1}var counter=0,original_el=void 0,drop_el=void 0,firefox=-1!=navigator.userAgent.indexOf("Firefox"),e_data={data:[],setData:function(t,e){this.data[t]=e},getData:function(t){return this.data[t]}},indicator={original_el:{},show:function(t){$("#indicator").css({width:t.width+"px",height:t.height+"px",left:t.left+"px",top:t.top+"px"})},hide:function(){$("#indicator").css({width:0,height:0,left:0,top:0})}},editor={verify_type:function(){$("#move").is(":checked")?($(".task__answer__item, .task__question>*").attr("draggable","true"),$(".block--empty").removeAttr("draggable"),$("[contenteditable]").attr("contenteditable","false")):($(".test__preview [draggable]").removeAttr("draggable"),$("[contenteditable]").attr("contenteditable","true"),$(".task__answer__item *").css("cursor","pointer"))},check_for_emptiness:function(){$(".task__question").each(function(t,e){0==$(this).children().length&&($(this).append("<div class='block--empty'>Добавьте сюда вопрос</div>"),add_boundary.block_empty($(this).children(".block--empty")))}),$(".task__answer").each(function(t,e){0==$(this).children().length&&($(this).append("<div class='block--empty'>Добавьте сюда поле ответа</div>"),add_boundary.block_empty($(this).children(".block--empty")))})}},add_boundary={draggable:function(t){t.bind({dragover:function(t){drag_over(t)},dragstart:function(t){this.classList.add("moved"),t.originalEvent.dataTransfer.setData("useless","stupid firefox")},dragend:function(t){drag_reset()}})},question:function(t){t.bind({dragenter:function(t){"question"==e_data.getData("el_type")&&(0==counter&&(this.classList.add("drop--accept"),c_rect=this.getBoundingClientRect(),indicator.original_el=this,indicator.show(c_rect)),counter++)},dragleave:function(t){counter--,0>=counter&&(counter=0,this.classList.remove("drop--accept"),indicator.hide())},dragstart:function(t){e_data.setData("el_type","question"),e_data.setData("el_class",$(this).attr("class").split(" ")[0]),original_el=this},drop:function(t){"question"==e_data.getData("el_type")&&(original_el?($(this).after($(original_el).attr("pos",parseInt($(this).attr("pos"))+1)),editor.check_for_emptiness()):append_test_item($(this),e_data.getData("el_class"),e_data.getData("el_type")))}})},answer:function(t){t.bind({dragenter:function(t){"answer"==e_data.getData("el_type")&&(0==counter&&(this.classList.add("drop--accept"),c_rect=this.getBoundingClientRect(),indicator.original_el=this,indicator.show(c_rect)),counter++)},dragstart:function(t){e_data.setData("el_type","answer"),e_data.setData("el_class",$(this).children("input").attr("class")),original_el=this},dragleave:function(t){counter--,0>=counter&&(counter=0,this.classList.remove("drop--accept"),indicator.hide())},drop:function(t){"answer"==e_data.getData("el_type")&&(original_el?($(this).after($(original_el).attr("pos",parseInt($(this).attr("pos"))+1)),editor.check_for_emptiness()):append_test_item($(this),e_data.getData("el_class"),e_data.getData("el_type")))}})},block_empty:function(t){t.bind({dragover:function(t){drag_over(t)},dragenter:function(t){$(this).parent().attr("class").split(" ")[0].split("__")[1]==e_data.getData("el_type")&&this.classList.add("drop--accept")},dragleave:function(t){$(this).parent().attr("class").split(" ")[0].split("__")[1]==e_data.getData("el_type")&&this.classList.remove("drop--accept")},drop:function(t){var e=$(this).parent();e.attr("class").split(" ")[0].split("__")[1]==e_data.getData("el_type")&&(original_el?($(this).replaceWith($(original_el).attr("pos","1")),editor.check_for_emptiness()):($(this).replaceWith(generate[e_data.getData("el_class")](1)),new_el=$(e.children()[0]),add_boundary.draggable(new_el),add_boundary[e_data.getData("el_type")](new_el)))}})},new_question:function(t){t.bind({dragover:function(t){drag_over(t)},dragenter:function(t){console.log(this),console.log("in",counter),0==counter&&(ripple.force_show(t.originalEvent,test_bg,"accent"),$(".test>svg").css({transform:"translateY(-50px)",opacity:1})),counter++},dragleave:function(t){console.log("out",counter),counter--,0==counter&&(ripple.dissolve(),$(".test>svg").css({transform:"",opacity:0}))},drop:function(t){console.log("drop",counter),t.stopPropagation&&t.stopPropagation(),counter>0&&create_question(e_data.getData("el_type"),e_data.getData("el_class"),original_el)}})}};$(document).ready(function(){editor.verify_type(),$("#editor__type").click(function(t){editor.verify_type()}),$(".answer__field").bind({dragstart:function(t){e_data.setData("el_type","answer"),e_data.setData("el_class",$(this).children("input").attr("class").split(" ")[0]),t.originalEvent.dataTransfer.setData("useless","stupid firefox")},dragend:function(t){drag_reset()}}),$(".question-elements>*").bind({dragstart:function(t){e_data.setData("el_type","question"),e_data.setData("el_class",$(this).attr("class")),t.originalEvent.dataTransfer.setData("useless","stupid firefox")},dragend:function(t){drag_reset()}}),test_bg=$(".test__bg").get(0),$(".test__bg, .test>svg").each(function(t,e){add_boundary.new_question($(this))}),$("#indicator").bind({dragover:function(t){drag_over(t)},dragenter:function(t){counter++,indicator.original_el.classList.add("drop--accept"),indicator.show(original_el.c_rect)},dragleave:function(t){counter--,0>=counter&&(indicator.original_el.classList.remove("drop--accept"),indicator.hide(),counter=0)},drop:function(t){t.stopPropagation&&t.stopPropagation(),$(indicator.original_el).trigger("drop",[{e:t}])}})});