test_manager.upload_queue={last_id:0,length:0,error:!1,_pending:[],add:function(){var e=this.last_id++;return this.length++,this._pending.push(e),e},remove:function(e){this._pending.remove(e),this.length--}},test_manager.packed_test={},test_manager.upload_test=function(){var e=JSON.parse(JSON.stringify(test_manager.packed_test));e.tasks.forEach(function(e){e.is_template&&(delete e.is_template,e.content=[],e.parts.forEach(function(t){e.content.push(generate.data.task.template.unwrap_replace(t,e.variables))}),delete e.variables,delete e.parts)}),delete e.templates;var t=new FormData;t.append("json_file",JSON.stringify(test_manager.packed_test)),t.append("course_id",django.course.id),defined(django.test.id)?t.append("test_id",django.test.id):t.append("material_id",django.material.id),t.append("csrfmiddlewaretoken",django.csrf_token),t.append("compiled_test",JSON.stringify(e)),$.ajax({type:"POST",url:"/"+django.current_type+"/save/",data:t,processData:!1,contentType:!1,success:function(e){notification.show(e.type,e.message),defined(django.test.id)?(window.history.pushState("Редактирование "+test_manager.packed_test.title,"Редактирование "+test_manager.packed_test.heading,"/test/edit/?course_id="+django.course.id+"&test_id="+django.test.id),$(".header>.__breadcrumbs>a").last().find("div").text(test_manager.packed_test.title)):window.history.pushState("Редактирование "+test_manager.packed_test.title,"Редактирование "+test_manager.packed_test.heading,"/material/edit/?course_id="+django.course.id+"&material_id="+django.material.id)}})},test_manager.drop=function(e){popup.show(loads.get("Elements/Modules/Test/manage/__popup_texts/__no_"+e+"/"),function(){$(".__ok").click(function(e){popup.hide()})})},test_manager.save=function(){if(test_manager.upload_queue.error=!1,test_manager.is_published){var e=test_manager.fix_test_strict(editor.test_data);if(!e)return!1}else{var e=test_manager.fix_test_soft(editor.test_data);if(!e)return!1}test_manager.pack(e),0!==test_manager.upload_queue.length&&(popup.show(loads.get("Elements/Modules/Test/manage/__popup_texts/__save/")),console.log(loads.get("Elements/Modules/Test/manage/__popup_texts/__save/")));var t=function(){0===test_manager.upload_queue.length?(test_manager.upload_queue.error?notification.show("error","Не удалось сохранить тест из-за ошбики с файлом. \n Его можно сохранить, если вы удалите поле, вызывающее ошибку."):test_manager.upload_test(),popup.hide()):setTimeout(t,100)};setTimeout(t,100)};