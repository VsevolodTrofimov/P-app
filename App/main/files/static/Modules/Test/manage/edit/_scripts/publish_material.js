test_manager.publish_material=function(){var e=test_manager.fix_test_strict(editor.test_data);e&&popup.show(test_manager.publish_popup,function(){var t=test_manager.collect_publish();e.tasks.forEach(function(e){e.is_template&&(delete e.is_template,e.content=[],e.parts.forEach(function(t){e.content.push(generate.data.task.template.unwrap_replace(t,e.variables))}),delete e.variables,delete e.parts)}),delete e.templates,$("#course_section").change(function(){"Новая..."===this.value?$("#new_section_name").removeAttr("disabled"):$("#new_section_name").attr("disabled","disabled")}),t.button.click(function(){test_manager.publish_parse(e)})},{width:"64rem"})},test_manager.publish_parse=function(e){var t=(test_manager.collect_publish(),!0),a={section:"Нераспределенные"};if("Новая..."===$("#course_section").val()?a.section=$("#new_section_name").val():a.section=$("#course_section").val(),a.section||(notification.show("warning","Выберите секцию для размещения теста"),t=!1),t){var n=new FormData;n.append("json_file",JSON.stringify(test_manager.packed_test)),n.append("course_id",django.course.id),defined(django.test.id)?n.append("test_id",django.test.id):n.append("material_id",django.material.id),n.append("csrfmiddlewaretoken",django.csrf_token),n.append("publish_data",JSON.stringify(a)),$.ajax({type:"POST",url:"/"+django.current_type+"/publish/",data:n,processData:!1,contentType:!1,success:function(e){notification.show(e.type,e.message),$("#"+django.current_type+"_publish").hide(),$("#"+django.current_type+"_unpublish").show(),popup.hide(),test_manager.save()},error:function(e){notification.show(e.type,e.message)}})}};