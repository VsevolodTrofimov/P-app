$(document).ready(function(){generate.data.task.template.edit.handle_actions=function(e,t){var a=e.find(".__mod_swap"),i=e.find(".__add"),d=e.find(".__save"),o=editor.active_template.group;defined(t)||(editor.active_template=JSON.parse(JSON.stringify(editor.active_template))),a.click(function(){if(console.log("was:",editor.template_editor_mode),"edit"===editor.template_editor_mode){editor.template_editor_mode="preview",editor.active_template=generate.data.task.template.element.parse_edit(e.find(".task").children(),editor.active_template);var t=generate.data.task.template.build(editor.active_template.parts,editor.active_template.variables,editor.active_template.group);t.find(".__actions button").css("pointer-events","none"),console.log(e),e.find(".task").html(t),a.html(loads["Elements/Icons/edit.svg"]).attr("tip","Редактировать")}else editor.template_editor_mode="edit",e.find(".task").html(generate.data.task.template.element.build_edit(editor.active_template.parts,editor.active_template.group)),generate.data.task.template.edit.observe_new_vars(e),a.html(loads["Elements/Icons/visibility.svg"]).attr("tip","Показать задание")}),t&&(i.html(loads["Elements/Icons/copy.svg"]),i.attr("tip","Создать новое задание (старое сохранится)")),i.click(function(){generate.data.task.template.add_to_test(editor.active_template,e)}),t?d.click(function(){"edit"===editor.template_editor_mode&&(editor.active_template=generate.data.task.template.element.parse_edit(e.find(".task").children(),editor.active_template)),$new_task=generate.data.task.template.build_finalized_task(editor.active_template).$task,$(t[1]).replaceWith($new_task),t[0].remove(),t=$new_task;var a=$(".preview .__task").index(t[1]);editor.test_data.tasks[a]=editor.active_template,editor.test_data.tasks[a].is_template=!0,editor.check.numbers()}):d.click(function(){"edit"===editor.template_editor_mode&&(editor.active_template=generate.data.task.template.element.parse_edit(e.find(".task").children(),editor.active_template)),editor.test_data.templates.save(editor.active_template,o),editor.template_ui.show(),console.log("rebuilding"),editor.test_data.tasks.forEach(function(e,t){if(e.is_template){var a=editor.test_data.template_get_parts(e.group);a&&(e.parts=a);var i=generate.data.task.template.build_finalized_task(e).$task[1];console.log("data:",e,"idx:",t),console.log("built:",i),$(".preview>.__content>.__task").eq(t).replaceWith(i)}}),editor.check.numbers()})}});